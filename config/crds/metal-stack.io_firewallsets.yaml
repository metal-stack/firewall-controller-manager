---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.10.0
  creationTimestamp: null
  name: firewallsets.metal-stack.io
spec:
  group: metal-stack.io
  names:
    kind: FirewallSet
    listKind: FirewallSetList
    plural: firewallsets
    shortNames:
    - fwset
    singular: firewallset
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.readyReplicas
      name: Ready
      type: integer
    - jsonPath: .status.progressingReplicas
      name: Progressing
      type: integer
    - jsonPath: .status.unhealthyReplicas
      name: Unhealthy
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v2
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            properties:
              replicas:
                type: integer
              template:
                description: FirewallSpec defines parameters for the firewall creation
                  along with configuration for the firewall-controller.
                properties:
                  controllerURL:
                    description: ControllerURL points to the downloadable binary artifact
                      of the firewall controller
                    type: string
                  controllerVersion:
                    description: ControllerVersion holds the firewall-controller version
                      to reconcile.
                    type: string
                  dryRun:
                    description: DryRun if set to true, firewall rules are not applied.
                      For devel-purposes only.
                    type: boolean
                  egressRules:
                    description: EgressRules contains egress rules configured for
                      this firewall.
                    items:
                      description: EgressRuleSNAT holds a Source-NAT rule
                      properties:
                        ips:
                          description: IPs contains the ips used as source addresses
                            for packets leaving the specified network.
                          items:
                            type: string
                          type: array
                        networkID:
                          description: NetworkID is the network for which the egress
                            rule will be configured.
                          type: string
                      required:
                      - ips
                      - networkID
                      type: object
                    type: array
                  image:
                    description: Image is the os image of the firewall. An update
                      on this field requires the recreation of the physical firewall
                      and can therefore lead to traffic interruption for the cluster.
                    type: string
                  internalPrefixes:
                    description: InternalPrefixes specify prefixes which are considered
                      local to the partition or all regions. This is used for the
                      traffic counters. Traffic to/from these prefixes is counted
                      as internal traffic.
                    items:
                      type: string
                    type: array
                  interval:
                    description: Interval on which rule reconciliation by the firewall-controller
                      should happen.
                    type: string
                  ipv4RuleFile:
                    description: TrafficControl defines where to store the generated
                      ipv4 firewall rules on disk.
                    type: string
                  logAcceptedConnections:
                    description: LogAcceptedConnections if set to true, also log accepted
                      connections in the droptailer log.
                    type: boolean
                  networks:
                    description: Networks are the networks to which this firewall
                      is connected. An update on this field requires the recreation
                      of the physical firewall and can therefore lead to traffic interruption
                      for the cluster.
                    items:
                      type: string
                    type: array
                  partition:
                    description: Partition is the partition in which the firewall
                      resides.
                    type: string
                  project:
                    description: Project is the project in which the firewall resides.
                    type: string
                  rateLimits:
                    description: RateLimits allows configuration of rate limit rules
                      for interfaces.
                    items:
                      description: RateLimit contains the rate limit rule for a network.
                      properties:
                        networkID:
                          description: NetworkID specifies the network which should
                            be rate limited.
                          type: string
                        rate:
                          description: Rate is the input rate in MiB/s.
                          format: int32
                          type: integer
                      required:
                      - networkID
                      - rate
                      type: object
                    type: array
                  size:
                    description: Size is the machine size of the firewall. An update
                      on this field requires the recreation of the physical firewall
                      and can therefore lead to traffic interruption for the cluster.
                    type: string
                  sshPublicKeys:
                    description: SSHPublicKeys are the public keys which are added
                      to the firewall's authorized keys file on creation.
                    items:
                      type: string
                    type: array
                required:
                - image
                - networks
                - partition
                - project
                - size
                type: object
            required:
            - replicas
            - template
            type: object
          status:
            properties:
              observedRevision:
                type: integer
              progressingReplicas:
                type: integer
              readyReplicas:
                type: integer
              targetReplicas:
                type: integer
              unhealthyReplicas:
                type: integer
            required:
            - observedRevision
            - progressingReplicas
            - readyReplicas
            - targetReplicas
            - unhealthyReplicas
            type: object
          userdata:
            type: string
        required:
        - userdata
        type: object
    served: true
    storage: true
    subresources:
      status: {}
