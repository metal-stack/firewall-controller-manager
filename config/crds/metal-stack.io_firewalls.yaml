---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.10.0
  creationTimestamp: null
  name: firewalls.metal-stack.io
spec:
  group: metal-stack.io
  names:
    kind: Firewall
    listKind: FirewallList
    plural: firewalls
    shortNames:
    - fw
    singular: firewall
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.machineStatus.machineID
      name: Machine ID
      type: string
    - jsonPath: .status.machineStatus.event
      name: Last Event
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v2
    schema:
      openAPIV3Schema:
        description: Firewall is the Schema for the firewalls API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: FirewallSpec defines the desired state of Firewall
            properties:
              controllerURL:
                description: ControllerURL points to the downloadable binary artifact
                  of the firewall controller
                type: string
              controllerVersion:
                description: ControllerVersion holds the firewall-controller version
                  to reconcile.
                type: string
              dryRun:
                description: DryRun if set to true, firewall rules are not applied
                type: boolean
              egressRules:
                description: EgressRules contains egress rules configured for this
                  firewall
                items:
                  description: EgressRuleSNAT holds a Source-NAT rule
                  properties:
                    ips:
                      items:
                        type: string
                      type: array
                    networkID:
                      type: string
                  required:
                  - ips
                  - networkID
                  type: object
                type: array
              image:
                description: Image is the os image used for the creation of the firewall
                type: string
              internalPrefixes:
                description: InternalPrefixes specify prefixes which are considered
                  local to the partition or all regions. Traffic to/from these prefixes
                  is accounted as internal traffic
                items:
                  type: string
                type: array
              interval:
                description: Interval on which rule reconciliation should happen
                type: string
              ipv4RuleFile:
                description: TrafficControl defines where to store the generated ipv4
                  firewall rules on disk
                type: string
              logAcceptedConnections:
                description: LogAcceptedConnections if set to true, also log accepted
                  connections in the droptailer log
                type: boolean
              networks:
                description: Networks are the networks to which this firewall is connected
                items:
                  type: string
                type: array
              partitionID:
                description: PartitionID is the partition in which the firewall gets
                  created
                type: string
              projectID:
                description: ProjectID is the project for which the firewall gets
                  created
                type: string
              rateLimits:
                description: RateLimits allows configuration of rate limit rules for
                  interfaces.
                items:
                  description: RateLimit contains the rate limit rule for a network.
                  properties:
                    networkID:
                      description: NetworkID specifies the network which should be
                        rate limited
                      type: string
                    rate:
                      description: Rate is the input rate in MiB/s
                      format: int32
                      type: integer
                  required:
                  - networkID
                  - rate
                  type: object
                type: array
              size:
                description: Size is the size for the firewall to be created
                type: string
              sshPublicKeys:
                description: SSHPublicKeys are the public keys which are added to
                  the firewall's authorized keys file after creation
                items:
                  type: string
                type: array
            required:
            - image
            - networks
            - partitionID
            - projectID
            - size
            type: object
          status:
            description: FirewallStatus defines the observed state of Firewall
            properties:
              controllerStatus:
                description: ControllerStatus holds the status of the firewall-controller
                  reconciling this firewall
                properties:
                  controllerVersion:
                    type: string
                  lastRun:
                    format: date-time
                    type: string
                  message:
                    type: string
                  stats:
                    description: FirewallStats contains firewall statistics
                    properties:
                      devices:
                        additionalProperties:
                          description: DeviceStat contains statistics of a device
                          properties:
                            in:
                              format: int64
                              type: integer
                            out:
                              format: int64
                              type: integer
                            total:
                              description: 'Deprecated: TotalBytes is kept for backwards
                                compatibility'
                              format: int64
                              type: integer
                          required:
                          - in
                          - out
                          - total
                          type: object
                        description: DeviceStatsByDevice contains DeviceStatistics
                          grouped by device name
                        type: object
                      idsStats:
                        additionalProperties:
                          properties:
                            drop:
                              type: integer
                            invalidChecksums:
                              type: integer
                            packets:
                              type: integer
                          required:
                          - drop
                          - invalidChecksums
                          - packets
                          type: object
                        type: object
                      rules:
                        additionalProperties:
                          additionalProperties:
                            description: RuleStat contains the statistics for a single
                              nftables rule
                            properties:
                              counter:
                                description: Counter holds values of a nftables counter
                                  object
                                properties:
                                  bytes:
                                    format: int64
                                    type: integer
                                  packets:
                                    format: int64
                                    type: integer
                                required:
                                - bytes
                                - packets
                                type: object
                            required:
                            - counter
                            type: object
                          description: RuleStats contains firewall rule statistics
                            of all rules of an action
                          type: object
                        description: 'RuleStatsByAction contains firewall rule statistics
                          groups by action: e.g. accept, drop, policy, masquerade'
                        type: object
                    required:
                    - devices
                    - idsStats
                    - rules
                    type: object
                required:
                - stats
                type: object
              firewallNetworks:
                description: FirewallNetworks holds refined information about the
                  networks that this firewall is connected to the information is used
                  by the firewall-controller in order to reconcile this firewall
                items:
                  properties:
                    asn:
                      format: int64
                      type: integer
                    destinationPrefixes:
                      items:
                        type: string
                      type: array
                    ips:
                      items:
                        type: string
                      type: array
                    nat:
                      type: boolean
                    networkID:
                      type: string
                    networkType:
                      type: string
                    prefixes:
                      items:
                        type: string
                      type: array
                    vrf:
                      format: int64
                      type: integer
                  required:
                  - asn
                  - destinationPrefixes
                  - ips
                  - nat
                  - networkID
                  - networkType
                  - prefixes
                  - vrf
                  type: object
                type: array
              machineStatus:
                description: MachineStatus holds the status of the firewall machine
                properties:
                  allocationTimestamp:
                    format: date-time
                    type: string
                  crashLoop:
                    type: boolean
                  event:
                    type: string
                  eventTimestamp:
                    format: date-time
                    type: string
                  liveliness:
                    type: string
                  machineID:
                    type: string
                  message:
                    type: string
                type: object
            type: object
          userdata:
            type: string
        required:
        - spec
        - userdata
        type: object
    served: true
    storage: true
    subresources:
      status: {}
